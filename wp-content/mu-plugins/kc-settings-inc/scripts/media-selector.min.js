window.kcSettings.mediaFieldsFrames={};jQuery(document).ready(function(a){var b=function(g,h,d){var f=g.find("img"),c=g.find("div.filename").text(h.title),i,e,d;if(h.type==="image"){if(d!=="thumbnail"&&h.sizes[d]){e=h.sizes[d];g.find("div.attachment-preview").add(g.find("div.thumbnail")).css({width:e.width,height:e.height})}else{e=h.sizes.thumbnail||h.sizes.medium||h.sizes.full;g.find("div.attachment-preview").add(g.find("div.thumbnail")).removeAttr("style")}f.attr("width",e.width);f.attr("height",e.height);i=e.url;c.hide();g.addClass("type-image")}else{i=h.icon;c.show();g.removeClass("type-image")}g.find("input").first().val(h.id).triggerHandler("change.kcSettings.mediaFields");f.attr("src",i);return g};a("ul.kc-media-list.multiple").sortable();a("body").on("click","a.kc-media-select",function(i){i.preventDefault();var g=a(this),f=g.data("fieldid"),d=a("#"+f),h=[];d.find("input").each(function(e,j){if(j.value!==""){h.push(j.value)}});d.data("current",h);if(window.kcSettings.mediaFieldsFrames[f]){window.kcSettings.mediaFieldsFrames[f].open();return}var c={className:"media-frame kc-media-frame",frame:"select",multiple:kcSettings.mediaFields[f].multiple,title:kcSettings.mediaFields[f].frame_title,button:{text:kcSettings.mediaFields[f].insert_button},syncSelection:false};if(kcSettings.mediaFields[f].mime_type!=="_all"){c.library={type:kcSettings.mediaFields[f].mime_type}}window.kcSettings.mediaFieldsFrames[f]=wp.media(c);window.kcSettings.mediaFieldsFrames[f].on("select",function(){var e=a("#"+f);var o=e.data("current");var l=e.children().first();var m=window.kcSettings.mediaFieldsFrames[f].state().get("selection");if(window.kcSettings.mediaFieldsFrames[f].options.multiple){var k=l.clone();var j=null;var n;m=m.toJSON();a.each(m,function(p,q){n=q.id.toString();if(a.inArray(n,o)>-1){return}e.append(b(k.clone(),q,e.data("size")))});if(e.is(".hidden")){l.remove()}}else{b(l,m.first().toJSON(),e.data("size"))}if(e.is(".hidden")){e.fadeIn(function(){e.removeClass("hidden")})}});window.kcSettings.mediaFieldsFrames[f].open()}).on("mouseenter","ul.kc-media-list li.attachment",function(c){a(this).addClass("details selected")}).on("mouseleave","ul.kc-media-list li.attachment",function(c){a(this).removeClass("details selected")}).on("click","ul.kc-media-list a.check",function(f){f.preventDefault();var d=a(this).closest("li");var c=d.parent();if(d.siblings().length){d.fadeOut(parseInt(c.data("animate")),function(){d.remove()})}else{c.fadeOut(parseInt(c.data("animate")),function(){c.addClass("hidden").removeAttr("style");d.find("input").val("")})}})});