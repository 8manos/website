var win=window.dialogArguments||opener||parent||top;(function(d){var c=win.kcSettings.upload.text,e=win.kcSettings.upload.target.data("currentFiles"),b=d(),a=d('<div class="kcs-wrap"><h4>'+c.head+'</h4> <a class="button check-all">'+c.checkAll+'</a> <a class="button check-invert">'+c.invert+'</a> <a class="button check-clear hidden">'+c.clear+'</a> <a class="button add-checked hidden">'+c.addFiles+"</a></div>").on("click","a",function(i){i.preventDefault();var f=d(this);if(f.is(".check-all")){b.prop("checked",true).trigger("change")}else{if(f.is(".check-clear")){b.prop("checked",false).trigger("change")}else{if(f.is(".check-invert")){b.each(function(){d(this).prop("checked",!this.checked).trigger("change")})}else{if(f.is(".add-checked")){var j=b.filter(":checked"),h=j.length;if(!h){return}var g={};j.each(function(){var k=this.value,m="file_"+k,l=d(this);g["file_"+k]={id:k,title:l.siblings(".title").text(),img:l.closest(".media-item").find(".pinkynail").attr("src")}});win.kcFileMultiple(g);win.tb_remove()}}}}});d.fn.kcsfPrepare=function(h,g){var i=win.kcSettings.upload.mimeType,f='<input type="checkbox" value="" class="kcs-files" />';return this.each(function(){var j=d(this),k=j.children();if(!k.length){return}if(!j.siblings("div.kcs-wrap").length){j.parent().append(a)}k.each(function(n){var m=d(this);if(m.find("input.kcs-files").length){return}var l=h?g:m.attr("id").split("-")[2],o=d("#type-of-"+l).val();var p=d(f);$label=d("<label />");p.val(l);if(d.inArray(l,e)>-1){p.prop("checked",true)}if(i!="all"&&i!=o){p.prop("disabled",true);$label.attr("title",win.kcSettings.upload.text.filenomatch)}b=b.add(p);m.children(".new").prepend(p).wrapInner($label)});b.trigger("change")})};d(document).ready(function(f){f("body").on("change","input.kcs-files",function(){var g=b.filter(function(h){return f(this).prop("checked")});if(g.length){f("a.add-checked, a.check-clear",a).removeClass("hidden")}else{f("a.add-checked, a.check-clear",a).addClass("hidden")}});f("#library-form, #gallery-form").find("#media-items").kcsfPrepare(false);f("#gallery-settings").hide();f("#media-upload").ajaxComplete(function(h,i,g){if(i.status!==200||g.url!=="async-upload.php"){return}f("#media-items",this).kcsfPrepare(true,i.responseText.match(/type-of-(\d+)/)[1])})})})(jQuery);