var win=window.dialogArguments||opener||parent||top;(function(a){a.fn.kcsfsPrepare=function(c,b){var d=win.kcSettings.upload.mimeType;return this.each(function(){var e=a(this),g=e.children();if(!g.length){return}var f=win.kcSettings.upload.target.find("input").val();g.each(function(){var i=a(this);if(i.find("a.kc-select").length){return}var h=c?b:i.attr("id").split("-")[2];if(h===f){return}var m=a("#type-of-"+h).val();if(d!="all"&&d!=m){return}var k=i.find("img.pinkynail").attr("src"),l=i.find(".title").text(),j=i.find("#type-of-"+h).val();a('<a href="#" class="kc-select" data-id="'+h+'" data-img="'+k+'" data-title="'+l+'" data-type="'+j+'">'+win.kcSettings.upload.text.selFile+"</a>").prependTo(i.children(".new"))})})};a(document).ready(function(b){b("#media-items").on("click","a.kc-select",function(c){c.preventDefault();win.kcFileSingle(b(this).data());win.tb_remove()});b("#library-form, #gallery-form").find("#media-items").kcsfsPrepare(false);b("#gallery-settings").hide();b("#media-upload").ajaxComplete(function(d,f,c){if(f.status!==200||c.url!=="async-upload.php"){return}b("#media-items",this).kcsfsPrepare(true,f.responseText.match(/type-of-(\d+)/)[1])})})})(jQuery);